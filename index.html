<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- framework -->
        <script src="js/riot-with-compiler.min.js"></script>
        <script src="js/riot-mixin-utils.js"></script>
        <script src="js/jszip.min.js"></script>
        <script src="js/FileSaver.min.js"></script>
        <script src="js/interact.min.js"></script>
        <script>
            var utils = riot.mixin('utils')
        </script>
        <script src="js/am-object.js"></script>
        <script src="js/am-text.js"></script>
        <script src="js/am-image.js"></script>
        <script src="js/am-listbox.js"></script>
        <script src="tags/layout.tag" type="riot/tag"></script>
        <script src="tags/menu.tag" type="riot/tag"></script>
        <script src="tags/menu-tools.tag" type="riot/tag"></script>
        <script src="tags/menu-layout.tag" type="riot/tag"></script>
        <script src="tags/menu-props.tag" type="riot/tag"></script>
        <script src="tags/menu-objects.tag" type="riot/tag"></script>
        <script src="tags/menu-data.tag" type="riot/tag"></script>
        <script src="tags/menu-triggers.tag" type="riot/tag"></script>
        <script src="tags/menu-files.tag" type="riot/tag"></script>
        <script src="tags/bar-top.tag" type="riot/tag"></script>
        <script src="tags/bar-bottom.tag" type="riot/tag"></script>
        <script src="tags/resizer.tag" type="riot/tag"></script>
        <link href="css/style.css" rel="stylesheet"></link>
        <link href="https://fonts.googleapis.com/css?family=Scope+One" rel="stylesheet">
    </head>
    <body>
        <div class="workspace no-select">
            <!-- top toolbar -->
            <bar-top class="horizontal-toolbar top"></bar-top>
            <div class="main">
                <menu></menu>
                <resizer></resizer>
                <layout></layout>
            </div>
            <!-- dev toolbar(s) -->
            <div class="horizontal-toolbar bottom">
                <span>Dev</span>
                <button onclick="console.dir(layout)">Layout</button>
                <button onclick="console.table(data.displays)">Displays</button>
                <button onclick="console.table(data.displays[data.displayIndex].romlist)">CurrentList</button>
                <button onclick="console.table(layout.config.files)">Files</button>
                <button onclick="console.dir(layout.selectedObject)">Object Vals</button>
            </div>
            <!-- bottom toolbar -->
            <bar-bottom class="horizontal-toolbar bottom"></bar-bottom>
        </div>
        <div class="modal">
            <div class="content"></div>
        </div>
        <script>
            //load sample data
            var data = {}
            utils.fetch('data/data.json', {
                json: true,
                complete: function(response) {
                    data = response.data
                    console.log('loaded data')
                }
            })

            var layout, barTop, barBottom, menu, menuTools, menuLayout, menuProps, menuObjects, menuData, menuTriggers, menuMedia, menuFonts, menuShaders
            riot.compile(function() {
                //setup menu
                menu = riot.mount('menu')[0]
                menu.setMenu({
                    accordian: false,
                    items: [
                        { label: 'Tools', content: '<menu-tools></menu-tools>' },
                        { label: 'Objects', expand: true, foldable: true, maxHeight: '160px', content: '<menu-objects></menu-objects>' },
                        { label: 'Properties', expand: false, foldable: true, maxHeight: '240px', content: '<menu-props></menu-props>' },
                        { label: 'Data', foldable: true, content: '<menu-data></menu-data>' },
                        { label: 'Layout', foldable: true, maxHeight: '160px', content: '<menu-layout></menu-layout>' },
                        { label: 'Triggers', foldable: true, content: '<menu-triggers></menu-triggers>' },
                        { label: 'Media', foldable: true, content: '<menu-files id="menu-media" allowed="image/*" file_type="media" drop_msg="Drag your media here"></menu-files>'},
                        { label: 'Fonts', foldable: true, content: '<menu-files id="menu-fonts" allowed=".ttf,.otf" file_type="font" drop_msg="Drag your fonts here"></menu-files>' },
                        { label: 'Shaders', foldable: true, content: '<menu-files id="menu-shaders" allowed=".vert,.frag" file_type="shader" drop_msg="Drag your shaders here"></menu-files>' },
                    ]
                })
                //mount menu components
                menuTools = riot.mount('menu-tools')[0]
                menuLayout = riot.mount('menu-layout')[0]
                menuProps = riot.mount('menu-props')[0]
                menuObjects = riot.mount('menu-objects')[0]
                menuData = riot.mount('menu-data')[0]
                menuTriggers = riot.mount('menu-triggers')[0]
                barTop = riot.mount('bar-top')[0]
                barBottom = riot.mount('bar-bottom')[0]
                menuMedia = riot.mount('#menu-media')[0]
                menuFonts = riot.mount('#menu-fonts')[0]
                menuShaders = riot.mount('#menu-shaders')[0]
                
                //hook up menu resizer
                var menuResizer = riot.mount('resizer')[0]
                menuResizer.on('resize', function(e) {
                    console.log('menu resizing')
                    document.querySelector('menu').style.flexBasis = (e.clientX + e.movementX - 2) + 'px'
                })
                
                //mount layout and hook components to the layout
                layout = riot.mount('layout')[0]
                barTop.setLayout(layout)
                barBottom.setLayout(layout)
                menuLayout.setLayout(layout)
                menuProps.setLayout(layout)
                menuObjects.setLayout(layout)
                menuData.setLayout(layout)
                menuMedia.setLayout(layout)
                menuFonts.setLayout(layout)
                menuShaders.setLayout(layout)
            })

            function showModal(html) {
                document.querySelector('.modal').style.display = 'block'
                document.querySelector('.modal .content').innerHTML = html
            }

            function closeModal() {
                document.querySelector('.modal').style.display = 'none'
            }
        </script>
    </body>
</html>